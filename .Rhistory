nm   = expand.grid(n_is, m_is)
n_is = c(3, 5, 10, 15, 25, 50)
m_is = c(3, 5, 10, 15, 20, 25, 40)
nm   = expand.grid(n_is, m_is)
nm
library(copula)
install.package("copula")
install.packages("copula")
library(copula)
rmvdc(copula = normalCopula(c(0.02, 0.3, 0.15), dim = 3, dispstr = "un"), margins = c("beta", "binom", "pois"))
mvdc(copula = normalCopula(c(0.02, 0.3, 0.15), dim = 3, dispstr = "un"), margins = c("beta", "binom", "pois"))
mvdc(copula = normalCopula(c(0.02, 0.3, 0.15), dim = 3, dispstr = "un"), margins = c("beta", "binom", "pois"), paramMargins = list(list(alpha = 1, beta = 2), list(size = 1, prob = 0.5), list(rate = 3)))
copula::mvdc
npmv::mvdc
?npmv::mvdc
install.packages("npmv")
?npmv::mvdc
library(npmv)
mvdc(copula = normalCopula(c(0.02, 0.3, 0.15), dim = 3, dispstr = "un"), margins = c("beta", "binom", "pois"), paramMargins = list(list(alpha = 1, beta = 2), list(size = 1, prob = 0.5), list(rate = 3)))
??mvdc
Mvdc(copula = normalCopula(c(0.02, 0.3, 0.15), dim = 3, dispstr = "un"), margins = c("beta", "binom", "pois"), paramMargins = list(list(alpha = 1, beta = 2), list(size = 1, prob = 0.5), list(rate = 3)))
rMvdc(copula = normalCopula(c(0.02, 0.3, 0.15), dim = 3, dispstr = "un"), margins = c("beta", "binom", "pois"), paramMargins = list(list(alpha = 1, beta = 2), list(size = 1, prob = 0.5), list(rate = 3)))
copula::rMvdc(copula = normalCopula(c(0.02, 0.3, 0.15), dim = 3, dispstr = "un"), margins = c("beta", "binom", "pois"), paramMargins = list(list(alpha = 1, beta = 2), list(size = 1, prob = 0.5), list(rate = 3)))
install.packages("gsl")
library(gsl)
library(gsl)
copula::rMvdc(copula = normalCopula(c(0.02, 0.3, 0.15), dim = 3, dispstr = "un"), margins = c("beta", "binom", "pois"), paramMargins = list(list(alpha = 1, beta = 2), list(size = 1, prob = 0.5), list(rate = 3)))
install.packages("copula", dependencies = T)
library(copula)
install.packages("gsl")
library(copula)
if(!require(pacman)) install.packages("pacman")
pacman::p_load(copula)
library(MASS)
MASS::rmvmpr,
rmvnorm
?rmvnorm
help(MASS)
MASS::mvrnorm(1, c(0, 0), diag(1, 0.03, 0.03, 1))
MASS::mvrnorm(1, c(0, 0), matrix(c(1, 0.03, 0.03, 1), ncol = 2))
a = MASS::mvrnorm(1, c(0, 0), matrix(c(1, 0.03, 0.03, 1), ncol = 2))
cor(a)
b = MASS::mvrnorm(1, c(0, 0), matrix(c(1, 0.03, 0.03, 1), ncol = 2))
cor(a, b)
b
a
a = replicate(5, MASS::mvrnorm(1, c(0, 0), matrix(c(1, 0.03, 0.03, 1), ncol = 2)))
a
a = c(a[1,], a[2,])
a
b = replicate(5, MASS::mvrnorm(1, c(0, 0), matrix(c(1, 0.03, 0.03, 1), ncol = 2)))
b = c(b[1,], b[2,])
cor(a, b)
a = replicate(5, MASS::mvrnorm(1, c(0, 0), matrix(c(1, 0.03, 0.03, 1), ncol = 2)))
a
cor(a[1,], a[2,])
library(mvnorm)
library(mvtnorm)
rmvnorm(5, c(0, 0), corr = matrix(c(1, 0.03, 0.03, 1), ncol = 2))
?rmvnorm
cor2cov
?cor2cov
cov2cor()
?cov2cor
rmvnorm(5, c(0, 0), Sigma = matrix(c(1, 0.03, 0.03, 1), ncol = 2))
?rmvnorm
rmvnorm(5, c(0, 0), sigma = matrix(c(1, 0.03, 0.03, 1), ncol = 2))
a = rmvnorm(5, c(0, 0), sigma = matrix(c(1, 0.03, 0.03, 1), ncol = 2))
cor(a[,1], a[,2])
matrix(c(1, .03, .03, 1), ncol = 2)
cov(a)
cor(a)
a = rmvnorm(500, c(0, 0), sigma = matrix(c(1, 0.03, 0.03, 1), ncol = 2))
cor(a)
cov(a)
a = rmvnorm(5000, c(0, 0), sigma = matrix(c(1, 0.03, 0.03, 1), ncol = 2))
cor(a)
cov(a)
install.packages("copula", dependencies = T)
library(copula)
install.packages("copula", dependencies = T)
install.packages("copula", repos="http://R-Forge.R-project.org")
install.packages("gsl")
install.packages("gss")
install.packages("gsl")
install.packages("gsl", dependencies = T)
SessionInfo()
sessionInfo()
install.packages("copula", dependencies = T)
library(copula)
library(ggplot2)
install.packages("ggplot2")
A = matrix(runif(20 * 10, 0, 0.1), ncol = 20)
A
ggplot()
?ggplot
ggplot(data = NULL)
library(ggplot2)
ggplot(data = NULL)
x = c(1:10)
x
-x
A[,16:20] = -A[, 16:20]
A[,6:10]
A[,6:10] = -A[, 6:10]
A[,16:20]
A$x = x
A$y = -x
A = matrix(runif(20 * 10, 0, 0.1), ncol = 20)
x = c(1:10)
A[,6:10] = -A[, 6:10]
A[,16:20] = -A[, 16:20]
A = as.data.frame(A)
A$x = x
A$y = -x
A$x
A$y
A
ggplot(A) + geom_blank()
ggplot(A, aes(x = x, y = V1))
A$V1
ggplot(A, aes(x = x, y = V1)) + geom_blank()
ggplot(A, aes(x = x, y = V1)) + geom_line()
ggplot(A, aes(x = x, y = V1)) + geom_line() + geom_blank()
ggplot(A, aes(x = x, y = V1)) + geom_line()
+ geom_line(aes(x = y, y = V11))
ggplot(A, aes(x = x, y = V1)) + geom_line() +
geom_line(aes(x = y, y = V11))
A$V11
ggplot(A, aes(x = x, y = V1)) + geom_line() +
geom_line(aes(x = y, y = V11)) +
geom_line(aes(x = x, y = V6))
ggplot(A, aes(x = x, y = V1)) + geom_line() +
geom_line(aes(x = y, y = V11)) +
geom_line(aes(x = x, y = V6)) +
geom_line(aes(x = y, y = V16))
ggplot(A, aes(x = x, y = V1)) + geom_line() +
geom_line(aes(x = y, y = V11)) +
geom_line(aes(x = x, y = V6)) +
geom_line(aes(x = y, y = V16)) +
geom_blank()
a = ggplot(A, aes(x = x, y = V1)) + geom_line()
b = ggplot(A) + geom_line(aes(x = y, y = V11))
d = ggplot(A) + geom_line(aes(x = x, y = V6))
e = ggplot(A) + geom_line(aes(x = y, y = V16))
gridExtra::grid.arrange(a, b, d, e, nrow = 2)
# number of Samples nn = 3, 5, 10, 25
# Identical Sample Size n_i = 3, 5, 10, 15, 25, 50, 100, 1000
# Identical Cluster Size m_ij = 3, 5, 10, 15, 20, 25, 40
# One Large, One Small Cluster m_ij = 10, 15, 20, 25; m_ik = 3; m_ih = 40
# One Large, One Small Sample n_i = 10, 15, 25, 50; n_j = 3; n_k = 150
# Identical Cluster Size m_ij = 3, 5, 10, 15, 20, 25, 40
# One Large, One Small Cluster m_ij = 10, 15, 20, 25; m_ik = 3; m_ih = 40
# number of samples
nn = c(3, 5, 10)
each_s = c(F, T)
both_s = c(F, T)
# Identical Sample Sizes --------------------------------------------------
n_i = c(3, 5, 10, 15, 20, 25, 50, 100)
# Identical Cluster Size
m_ij = c(3, 5, 10, 15, 20, 25, 40)
nm_1 = expand.grid(nn, n_i, m_ij)
nm_1$each_s = F
nm_1$both_s = F
nm_1$identical_s = T
nm_1$identical_c = T
nm_1$grp = 1
colnames(nm_1)[1:3] = c("nn", "n_i", "m_ij")
# Large/Small Cluster
m_ij = c(10, 15, 20, 25)
nm_2 = expand.grid(nn, n_i, m_ij, each_s, both_s)
nm_2$identical_s = T
nm_2$identical_c = F
colnames(nm_2)[1:5] = c("nn", "n_i", "m_ij", "each_s", "both_s")
# Remove invalid condition
nm_2 = nm_2[-which(which(nm_2$each_s == T) %in% which(nm_2$both_s == F)),]
nm_2$grp = 2
# Large/Small Sample Size -------------------------------------------------
n_i = c(10, 15, 25, 50)
# Identical Cluster Size
m_ij = c(3, 5, 10, 15, 20, 25, 40)
nm_3 = expand.grid(nn, n_i, m_ij)
nm_3$each_s = F
nm_3$both_s = F
nm_3$identical_s = F
nm_3$identical_c = T
nm_3$grp = 3
colnames(nm_3)[1:3] = c("nn", "n_i", "m_ij")
# Large/Small Cluster
m_ij = c(10, 15, 20, 25)
nm_4 = expand.grid(nn, n_i, m_ij, each_s, both_s)
nm_4$identical_s = F
nm_4$identical_c = F
colnames(nm_4)[1:5] = c("nn", "n_i", "m_ij", "each_s", "both_s")
nm_4 = nm_4[-which(which(nm_4$each_s == T) %in% which(nm_4$both_s == F)),]
nm_4$grp = 4
# Bind --------------------------------------------------------------------
samples = rbind(nm_1, nm_2, nm_3, nm_4)
sets = samples[3]
sets = samples[3,]
sets$nn
samples
head(samples)
settings = samples
settings$rho  = rho
settings$wald = 0
settings$anv  = 0
settings$maxt = 0
which(colnames(settings) == c("wald", "anv", "maxt"))
which(colnames(settings) %in% c("wald", "anv", "maxt"))
settings[,9:11]
which(colnames(settings) %in% c("wald", "anv", "maxt"))
AB = list()
names(AB)
AB[[1]] = rnorm(100)
names(AB)
names(AB) = "a"
names(AB)
AB
AB$a
install.packages("doParallel", dependencies = T)
library(foreach)
library(doParallel)
cores=detectCores()
cores
cl <- makeCluster(cores-1) #not to overload your computer
ab = numeric(100)
registerDoParallel(cl)
foreach(i in 1:100) %dopar% {
ab[i] = i
}
foreach(i=1:100) %dopar% {
ab[i] = i
}
ab = foreach(i=1:100) %dopar% {
i
}
ab
ab = numeric(100)
ab = foreach(i=1:100, .combine = "c") %dopar% {
i
}
names(ab)
ab
#ab = numeric(100)
ab = matrix(NA, nrow = 1000, ncol = 4)
ab = foreach(i=1:100, .combine = "cbind") %dopar% {
rep(i, 4)
}
ab
#ab = numeric(100)
ab = matrix(NA, nrow = 1000, ncol = 4)
ab = foreach(i=1:100, .combine = "rbind") %dopar% {
rep(i, 4)
}
ab
#ab = numeric(100)
ab = matrix(NA, nrow = 1000, ncol = 4)
ab = foreach(i=1:1000, .combine = "rbind") %dopar% {
rep(i, 4)
}
all(ab[,1] == c(1:1000))
stopCluster()
cores=detectCores()
cl <- makeCluster(cores-1) #not to overload your computer
registerDoParallel(cl)
stopCluster(cl)
foreach(i=1:1000, .combine = "rbind") %dopar% {
ab =  rep(i, 4)
}
cores=detectCores()
cl <- makeCluster(cores-1) #not to overload your computer
registerDoParallel(cl)
#ab = numeric(100)
ab = matrix(NA, nrow = 1000, ncol = 4)
foreach(i=1:1000, .combine = "rbind") %dopar% {
ab =  rep(i, 4)
}
ab
#ab = numeric(100)
ab = matrix(NA, nrow = 1000, ncol = 4)
ab = foreach(i=1:1000, .combine = "rbind") %dopar% {
c(sqrt(4), 3, 1, 2^2)
}
ab
#ab = numeric(100)
ab = matrix(NA, nrow = 1000, ncol = 4)
ab = foreach(i=1:1000, .combine = "rbind") %dopar% {
a = sqrt(4)
c(a^2, 3, 1, 2^2)
}
ab
setwd("D:/Dropbox/Studium/M.Sc. Statistics/Semester IV/Thesis/Code/MasterThesis")
# Preparation -------------------------------------------------------------
if(!("MASS" %in% installed.packages())) install.packages("MASS", dependencies = T)
if(!("mvtnorm" %in% installed.packages())) install.packages("mvtnorm", dependencies = T)
if(!("copula" %in% installed.packages())) install.packages("copula", dependencies = T)
if(!("multcomp" %in% installed.packages())) install.packages("multcomp", dependencies = T)
if(!("Rcpp" %in% installed.packages())) install.packages("Rcpp", dependencies = T)
if(!("RcppArmadillo" %in% installed.packages())) install.packages("RcppArmadillo", dependencies = T)
if(!("doParallel" %in% installed.packages())) install.packages("doParallel", dependencies = T)
if(!("foreach" %in% installed.packages())) install.packages("foreach")
source("util.R")
source("dat_gen.R")
source("stats.R")
source("settings.R")
source("sim_fun.R")
source("utilcpp_wrap.R")
# Simulation --------------------------------------------------------------
nsim  = 100 # Number of Simulation Runs
dists = c("norm", "pois", "beta", "binom")
param_list = list(list(mean = 0, sd = 1), list(lambda = 3), list(shape1 = 2, shape2 = 5), list(size = 1, prob = 0.5))
stopCluster()
start_time = Sys.time()
for(u in 1:length(dists)){
sim_fun(nsim, dists[u], param_list[[u]], samples, NULL, "Dunnett")
}
stop_time = Sys.time()
View(h_0_f)
stopCluster()
nsim  = 100 # Number of Simulation Runs
dists = c("norm", "pois", "beta", "binom")
param_list = list(list(mean = 0, sd = 1), list(lambda = 3), list(shape1 = 2, shape2 = 5), list(size = 1, prob = 0.5))
start_time = Sys.time()
for(u in 1:length(dists)){
sim_fun(nsim, dists[u], param_list[[u]], samples, NULL, "Dunnett")
}
stop_time = Sys.time()
z
nsim  = 100 # Number of Simulation Runs
dists = c("norm", "pois", "beta", "binom")
param_list = list(list(mean = 0, sd = 1), list(lambda = 3), list(shape1 = 2, shape2 = 5), list(size = 1, prob = 0.5))
start_time = Sys.time()
for(u in 1:length(dists)){
sim_fun(nsim, dists[u], param_list[[u]], samples, NULL, "Dunnett")
}
stop_time = Sys.time()
dists = c("norm", "pois", "beta", "binom")
param_list = list(list(mean = 0, sd = 1), list(lambda = 3), list(shape1 = 2, shape2 = 5), list(size = 1, prob = 0.5))
dist_c = "norm"
dist_params = param_list[[1]]
c_type = "Dunnett"
results = list()
# No Correlation ----------------------------------------------------------
settings = samples
settings$rho  = 0
settings$dist = dist_c
settings$f_2  = 0
settings$wald = 0
settings$anv  = 0
settings$maxt = 0
z = 3
sets = settings[z,]
sizes = nm_gen(nn = sets$nn, n_i = sets$n_i, m_ij = sets$m_ij, each_s = sets$each_s, both_s = sets$both_s, identical_s = sets$identical_s, identical_c = sets$identical_c)
f2 = sum(sizes[[1]]) - length(sizes[[1]])
c_mat = contrMat(sizes[[1]], type = c_type) %*% diag(1, length(sizes[[1]]))
dec = matrix(0, nrow = 3, ncol = nsim)
theta = rep(1/sets$nn, length(sizes[[1]]))
psi = NULL
data_n = h_0_f(sizes[[1]], sizes[[2]], dist = dist_c, corstruct = "independent", rho = settings$rho[z], params = dist_params)
decc = foreach(1:1000, .combine = "cbind") %dopar% {
data_t = h_0_f(sizes[[1]], sizes[[2]], dist = dist_c, corstruct = "independent", rho = settings$rho[z], params = dist_params)
r1 = q_anova(sizes[[1]], data_t, c_mat, f2, theta = NULL, psi = NULL, alpha = 0.05)$reject
r2 = Q_anova(rel_eff(data_n), sigma_est(sizes[[1]], data_t, theta = theta, psi = NULL), c_mat, f2, sizes[[1]], 0.05)$reject
c(r1, r2)
}
decc = foreach(1:1000, .combine = "cbind") %dopar% {
data_t = h_0_f(sizes[[1]], sizes[[2]], dist = dist_c, corstruct = "independent", rho = settings$rho[z], params = dist_params)
#r1 = q_anova(sizes[[1]], data_t, c_mat, f2, theta = NULL, psi = NULL, alpha = 0.05)$reject
#r2 = Q_anova(rel_eff(data_n), sigma_est(sizes[[1]], data_t, theta = theta, psi = NULL), c_mat, f2, sizes[[1]], 0.05)$reject
#c(r1, r2)
mean(data_t[[1]])
}
data_t = h_0_f(sizes[[1]], sizes[[2]], dist = dist_c, corstruct = "independent", rho = settings$rho[z], params = dist_params)
data_t
decc = foreach(1:1000, .combine = "cbind") %dopar% {
data_t = h_0_f(sizes[[1]], sizes[[2]], dist = dist_c, corstruct = "independent", rho = settings$rho[z], params = dist_params)
#r1 = q_anova(sizes[[1]], data_t, c_mat, f2, theta = NULL, psi = NULL, alpha = 0.05)$reject
#r2 = Q_anova(rel_eff(data_n), sigma_est(sizes[[1]], data_t, theta = theta, psi = NULL), c_mat, f2, sizes[[1]], 0.05)$reject
#c(r1, r2)
mean(data_t[[1]][[1]])
}
decc = foreach(1:1000, .combine = "cbind") %dopar% {
data_t = h_0_f(sizes[[1]], sizes[[2]], dist = dist_c, corstruct = "independent", rho = settings$rho[z], params = dist_params)
r1 = q_anova(sizes[[1]], data_t, c_mat, f2, theta = NULL, psi = NULL, alpha = 0.05)$reject
#r2 = Q_anova(rel_eff(data_n), sigma_est(sizes[[1]], data_t, theta = theta, psi = NULL), c_mat, f2, sizes[[1]], 0.05)$reject
#c(r1, r2)
c(mean(data_t[[1]][[1]]), r1)
}
decc = foreach(1:1000, .combine = "cbind") %dopar% {
data_t = h_0_f(sizes[[1]], sizes[[2]], dist = dist_c, corstruct = "independent", rho = settings$rho[z], params = dist_params)
#r1 = q_anova(sizes[[1]], data_t, c_mat, f2, theta = NULL, psi = NULL, alpha = 0.05)$reject
r2 = Q_anova(rel_eff(data_n), sigma_est(sizes[[1]], data_t, theta = theta, psi = NULL), c_mat, f2, sizes[[1]], 0.05)$reject
#c(r1, r2)
c(mean(data_t[[1]][[1]]), r2)
}
stopCluster()
q_anova(sizes[[1]], data_n, c_mat, f2, theta = NULL, psi = NULL, alpha = 0.05)
q_anova(sizes[[1]], data_n, c_mat, f2, theta = NULL, psi = NULL, alpha = 0.05)$reject
q_wald(sizes[[1]], data_n, c_mat, theta = NULL, psi = NULL, alpha = 0.05)$reject
decc = foreach(1:1000, .combine = "cbind") %dopar% {
data_t = h_0_f(sizes[[1]], sizes[[2]], dist = dist_c, corstruct = "independent", rho = settings$rho[z], params = dist_params)
psi = NULL
if(is.null(psi)){
psi = list()
for(i in 1:length(data)){
psi[[i]] = rep(1 / length(data[[i]]), length(data[[i]]))
}
}
r1 = q_anova(sizes[[1]], data_t, c_mat, f2, theta = NULL, psi = NULL, alpha = 0.05)$reject
r2 = Q_anova(rel_eff(data_n), sigma_est(sizes[[1]], data_t, theta = theta, psi = NULL), c_mat, f2, sizes[[1]], 0.05)$reject
#c(r1, r2)
c(mean(data_t[[1]][[1]]), r1, r2)
}
decc = foreach(1:1000, .combine = "cbind") %dopar% {
data_t = h_0_f(sizes[[1]], sizes[[2]], dist = dist_c, corstruct = "independent", rho = settings$rho[z], params = dist_params)
psi = NULL
if(is.null(psi)){
psi = list()
for(i in 1:length(data)){
psi[[i]] = rep(1 / length(data[[i]]), length(data[[i]]))
}
}
r1 = q_anova(sizes[[1]], data_t, c_mat, f2, theta = NULL, psi = psi, alpha = 0.05)$reject
r2 = Q_anova(rel_eff(data_n), sigma_est(sizes[[1]], data_t, theta = theta, psi = psi), c_mat, f2, sizes[[1]], 0.05)$reject
#c(r1, r2)
c(mean(data_t[[1]][[1]]), r1, r2)
}
decc = foreach(1:1000, .combine = "cbind") %dopar% {
data_t = h_0_f(sizes[[1]], sizes[[2]], dist = dist_c, corstruct = "independent", rho = settings$rho[z], params = dist_params)
psi = list()
for(i in 1:length(data)){
psi[[i]] = rep(1 / length(data[[i]]), length(data[[i]]))
}
r1 = q_anova(sizes[[1]], data_t, c_mat, f2, theta = NULL, psi = psi, alpha = 0.05)$reject
r2 = Q_anova(rel_eff(data_n), sigma_est(sizes[[1]], data_t, theta = theta, psi = psi), c_mat, f2, sizes[[1]], 0.05)$reject
#c(r1, r2)
c(mean(data_t[[1]][[1]]), r1, r2)
}
dist_params
dist_c
decc = foreach(1:1000, .combine = "cbind") %dopar% {
data_t = h_0_f(sizes[[1]], sizes[[2]], dist = dist_c, corstruct = "independent", rho = settings$rho[z], params = dist_params)
psi = list()
for(i in 1:length(data)){
psi[[i]] = rep(1 / length(data[[i]]), length(data[[i]]))
}
r1 = q_anova(sizes[[1]], data_t, c_mat, f2, theta = theta, psi = psi, alpha = 0.05)$reject
r2 = Q_anova(rel_eff(data_n), sigma_est(sizes[[1]], data_t, theta = theta, psi = psi), c_mat, f2, sizes[[1]], 0.05)$reject
#c(r1, r2)
c(mean(data_t[[1]][[1]]), r1, r2)
}
decc = foreach(1:1000, .combine = "cbind") %dopar% {
#data_t = h_0_f(sizes[[1]], sizes[[2]], dist = dist_c, corstruct = "independent", rho = settings$rho[z], params = dist_params)
#   psi = list()
#   for(i in 1:length(data)){
#     psi[[i]] = rep(1 / length(data[[i]]), length(data[[i]]))
#   }
# r1 = q_anova(sizes[[1]], data_t, c_mat, f2, theta = theta, psi = psi, alpha = 0.05)$reject
# r2 = Q_anova(rel_eff(data_n), sigma_est(sizes[[1]], data_t, theta = theta, psi = psi), c_mat, f2, sizes[[1]], 0.05)$reject
# #c(r1, r2)
#c(mean(data_t[[1]][[1]]), r1, r2)
sim_fun2()
}
sim_fun2 = function(){
data_t = h_0_f(sizes[[1]], sizes[[2]], dist = dist_c, corstruct = "independent", rho = settings$rho[z], params = dist_params)
r1 = q_anova(sizes[[1]], data_t, c_mat, f2, theta = NULL, psi = NULL, alpha = 0.05)$reject
r2 = Q_anova(rel_eff(data_n), sigma_est(sizes[[1]], data_t, theta = theta, psi = NULL), c_mat, f2, sizes[[1]], 0.05)$reject
return(c(r1, r2))
}
decc = foreach(1:1000, .combine = "cbind") %dopar% {
#data_t = h_0_f(sizes[[1]], sizes[[2]], dist = dist_c, corstruct = "independent", rho = settings$rho[z], params = dist_params)
#   psi = list()
#   for(i in 1:length(data)){
#     psi[[i]] = rep(1 / length(data[[i]]), length(data[[i]]))
#   }
# r1 = q_anova(sizes[[1]], data_t, c_mat, f2, theta = theta, psi = psi, alpha = 0.05)$reject
# r2 = Q_anova(rel_eff(data_n), sigma_est(sizes[[1]], data_t, theta = theta, psi = psi), c_mat, f2, sizes[[1]], 0.05)$reject
# #c(r1, r2)
#c(mean(data_t[[1]][[1]]), r1, r2)
sim_fun2()
}
decc = foreach(1:1000, .combine = "cbind") %do% {
#data_t = h_0_f(sizes[[1]], sizes[[2]], dist = dist_c, corstruct = "independent", rho = settings$rho[z], params = dist_params)
#   psi = list()
#   for(i in 1:length(data)){
#     psi[[i]] = rep(1 / length(data[[i]]), length(data[[i]]))
#   }
# r1 = q_anova(sizes[[1]], data_t, c_mat, f2, theta = theta, psi = psi, alpha = 0.05)$reject
# r2 = Q_anova(rel_eff(data_n), sigma_est(sizes[[1]], data_t, theta = theta, psi = psi), c_mat, f2, sizes[[1]], 0.05)$reject
# #c(r1, r2)
#c(mean(data_t[[1]][[1]]), r1, r2)
sim_fun2()
}
rowMeans(decc)
cores=detectCores()
cl <- makeCluster(cores-1) #not to overload your computer
registerDoParallel(cl)
decc = foreach(1:1000, .combine = "cbind") %dopar% {
#data_t = h_0_f(sizes[[1]], sizes[[2]], dist = dist_c, corstruct = "independent", rho = settings$rho[z], params = dist_params)
#   psi = list()
#   for(i in 1:length(data)){
#     psi[[i]] = rep(1 / length(data[[i]]), length(data[[i]]))
#   }
# r1 = q_anova(sizes[[1]], data_t, c_mat, f2, theta = theta, psi = psi, alpha = 0.05)$reject
# r2 = Q_anova(rel_eff(data_n), sigma_est(sizes[[1]], data_t, theta = theta, psi = psi), c_mat, f2, sizes[[1]], 0.05)$reject
# #c(r1, r2)
#c(mean(data_t[[1]][[1]]), r1, r2)
sim_fun2()
}
stopCluster()
stopCluster(cl)
